openapi: 3.0.3
info:
  title: Tic-Tac-Toe Game API
  description: API for managing tic-tac-toe games with customizable board sizes
  version: 1.0.0
  contact:
    name: API Support

servers:
  - url: http://localhost:3001/api
    description: Local development server

tags:
  - name: games
    description: Game management operations
  - name: moves
    description: Move management operations

paths:
  /games:
    get:
      tags:
        - games
      summary: Get all games
      description: Retrieve a list of all games, optionally filtered by status
      operationId: getAllGames
      parameters:
        - name: status
          in: query
          description: Filter games by status
          required: false
          schema:
            type: string
            enum: [in_progress, completed, abandoned]
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/GameWithMoveCount'
        '500':
          $ref: '#/components/responses/InternalServerError'

    post:
      tags:
        - games
      summary: Create a new game
      description: Create a new tic-tac-toe game with optional custom board size
      operationId: createGame
      requestBody:
        description: Game creation parameters
        content:
          application/json:
            schema:
              type: object
              properties:
                board_size:
                  type: integer
                  minimum: 3
                  maximum: 10
                  default: 3
                  description: Size of the game board (3-10)
      responses:
        '201':
          description: Game created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Game'
                  message:
                    type: string
                    example: Game created successfully
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /games/{id}:
    get:
      tags:
        - games
      summary: Get game by ID
      description: Retrieve a specific game by its ID
      operationId: getGameById
      parameters:
        - $ref: '#/components/parameters/GameId'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Game'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    patch:
      tags:
        - games
      summary: Update game
      description: Update game status, winner, or current player
      operationId: updateGame
      parameters:
        - $ref: '#/components/parameters/GameId'
      requestBody:
        description: Game update parameters
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum: [in_progress, completed, abandoned]
                  description: Game status
                winner:
                  type: string
                  enum: [X, O, draw]
                  nullable: true
                  description: Game winner
                current_player:
                  type: string
                  enum: [X, O]
                  description: Current player
      responses:
        '200':
          description: Game updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Game'
                  message:
                    type: string
                    example: Game updated successfully
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      tags:
        - games
      summary: Delete game
      description: Delete a game and all its associated moves
      operationId: deleteGame
      parameters:
        - $ref: '#/components/parameters/GameId'
      responses:
        '200':
          description: Game deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    nullable: true
                  message:
                    type: string
                    example: Game deleted successfully
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /games/{id}/full:
    get:
      tags:
        - games
      summary: Get game with all moves
      description: Retrieve a game with all its moves
      operationId: getGameWithMoves
      parameters:
        - $ref: '#/components/parameters/GameId'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/GameWithMoves'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /games/{id}/moves:
    get:
      tags:
        - moves
      summary: Get game moves
      description: Retrieve all moves for a specific game
      operationId: getGameMoves
      parameters:
        - $ref: '#/components/parameters/GameId'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Move'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    post:
      tags:
        - moves
      summary: Add move to game
      description: Add a new move to an active game
      operationId: addMove
      parameters:
        - $ref: '#/components/parameters/GameId'
      requestBody:
        description: Move parameters
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - position
                - player
              properties:
                position:
                  type: integer
                  minimum: 0
                  description: Board position (0-8 for 3x3, 0-24 for 5x5, etc.)
                  example: 4
                player:
                  type: string
                  enum: [X, O]
                  description: Player making the move
                  example: X
      responses:
        '201':
          description: Move added successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Move'
                  message:
                    type: string
                    example: Move added successfully
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  parameters:
    GameId:
      name: id
      in: path
      description: Game ID
      required: true
      schema:
        type: integer
        minimum: 1
      example: 1

  schemas:
    Game:
      type: object
      properties:
        id:
          type: integer
          description: Unique game identifier
          example: 1
        board_size:
          type: integer
          minimum: 3
          maximum: 10
          description: Size of the game board
          example: 3
        status:
          type: string
          enum: [in_progress, completed, abandoned]
          description: Current game status
          example: in_progress
        winner:
          type: string
          enum: [X, O, draw]
          nullable: true
          description: Game winner (null if game is in progress)
          example: null
        current_player:
          type: string
          enum: [X, O]
          description: Player whose turn it is
          example: X
        created_at:
          type: string
          format: date-time
          description: Game creation timestamp
          example: "2025-11-05T10:00:00.000Z"
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp
          example: "2025-11-05T10:00:00.000Z"

    GameWithMoveCount:
      allOf:
        - $ref: '#/components/schemas/Game'
        - type: object
          properties:
            move_count:
              type: integer
              description: Number of moves made in the game
              example: 3

    GameWithMoves:
      allOf:
        - $ref: '#/components/schemas/Game'
        - type: object
          properties:
            moves:
              type: array
              items:
                $ref: '#/components/schemas/Move'

    Move:
      type: object
      properties:
        id:
          type: integer
          description: Unique move identifier
          example: 1
        game_id:
          type: integer
          description: ID of the game this move belongs to
          example: 1
        move_number:
          type: integer
          minimum: 1
          description: Sequential move number in the game
          example: 1
        position:
          type: integer
          minimum: 0
          description: Board position of the move
          example: 4
        player:
          type: string
          enum: [X, O]
          description: Player who made the move
          example: X
        created_at:
          type: string
          format: date-time
          description: Move creation timestamp
          example: "2025-11-05T10:01:00.000Z"

    Error:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: object
          properties:
            message:
              type: string
              description: Error message
              example: Invalid game ID
            statusCode:
              type: integer
              description: HTTP status code
              example: 400

  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            invalidId:
              summary: Invalid game ID
              value:
                success: false
                error:
                  message: Invalid game ID
                  statusCode: 400
            gameNotInProgress:
              summary: Game not in progress
              value:
                success: false
                error:
                  message: Cannot add move to a game that is not in progress
                  statusCode: 400

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            success: false
            error:
              message: Game with ID 999 not found
              statusCode: 404

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            success: false
            error:
              message: An unexpected error occurred
              statusCode: 500
